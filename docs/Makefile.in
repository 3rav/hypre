#BHEADER***********************************************************************
# (c) 1998   The Regents of the University of California
#
# See the file COPYRIGHT_and_DISCLAIMER for a complete copyright
# notice, contact person, and disclaimer.
#
# $Revision$
#EHEADER***********************************************************************

.SUFFIXES:
.SUFFIXES: .c .dxx .html .tex

srcdir = @srcdir@
VPATH = @srcdir@

LATEX = latex -interaction=nonstopmode
MAKEINDEX = makeindex -q
DVIPS = dvips -q

ONLINE_OPTS =\
 -split 2\
 -show_section_numbers\
 -bottom_navigation

##################################################################
# Targets
##################################################################

all: html ps

install: all
	@cp -fr HYPRE_usr_manual    $$HYPRE_INSTALL_DIR/docs/.
	@cp -f  HYPRE_usr_manual.ps $$HYPRE_INSTALL_DIR/docs/.
	@cp -fr HYPRE_ref_manual    $$HYPRE_INSTALL_DIR/docs/.
	@cp -f  HYPRE_ref_manual.ps $$HYPRE_INSTALL_DIR/docs/.

clean:
	@/bin/rm -f *.aux *.bbl *.blg *.dvi *.log *.dlog *.toc
	@/bin/rm -f *.idx *.ilg *.ind 
	@/bin/rm -f ref_manual.tex version.tex

veryclean: clean
	@/bin/rm -fr HYPRE_usr_manual
	@/bin/rm -f  HYPRE_usr_manual.ps
	@/bin/rm -fr HYPRE_dev_manual
	@/bin/rm -f  HYPRE_dev_manual.ps
	@/bin/rm -fr HYPRE_ref_manual
	@/bin/rm -f  HYPRE_ref_manual.tex HYPRE_ref_manual.ps

##################################################################
# Rules
##################################################################

html: usr_html dev_html ref_html

ps: usr_ps dev_ps ref_ps

usr: usr_html usr_ps
usr_html: HYPRE_usr_manual/usr_manual.html
usr_ps: HYPRE_usr_manual.ps

dev: dev_html dev_ps
dev_html: HYPRE_dev_manual/dev_manual.html
dev_ps: HYPRE_dev_manual.ps

ref: ref_html ref_ps
ref_html: HYPRE_ref_manual/index.html
ref_ps: HYPRE_ref_manual.ps

##########

USR_FILES =\
 usr_interlang.tex\
 usr_ij.tex\
 usr_building_code.tex\
 usr_struct.tex\
 usr_sstruct.tex\
 usr_manual.tex

HYPRE_usr_manual/usr_manual.html: usr_manual.dvi
	latex2html ${ONLINE_OPTS} -dir HYPRE_usr_manual usr_manual.tex 2>&1
	@cp -f hypre_wiw.gif HYPRE_usr_manual/.

HYPRE_usr_manual.ps: usr_manual.dvi
	${DVIPS} -o HYPRE_usr_manual.ps usr_manual

usr_manual.dvi: version.tex usr_manual.idx
	${LATEX} usr_manual
	${LATEX} usr_manual

usr_manual.idx: ${USR_FILES} 
	${LATEX} usr_manual
	bibtex usr_manual
	${MAKEINDEX} usr_manual.idx

##########

DEV_FILES =\
 dev_QA.tex\
 dev_autotest.tex\
 dev_coding.tex\
 dev_design.tex\
 dev_documentation.tex\
 dev_error_handling.tex\
 dev_install.tex\
 dev_language_interop.tex\
 dev_makefile.tex\
 dev_reference.tex\
 dev_repository.tex\
 dev_requirements.tex\
 dev_manual.tex

HYPRE_dev_manual/dev_manual.html: dev_manual.dvi
	latex2html ${ONLINE_OPTS} -dir HYPRE_dev_manual dev_manual.tex 2>&1
	@cp -f hypre_wiw.gif HYPRE_dev_manual/.

HYPRE_dev_manual.ps: dev_manual.dvi
	${DVIPS} -o HYPRE_dev_manual.ps dev_manual

dev_manual.dvi: version.tex dev_manual.idx
	${LATEX} dev_manual
	${LATEX} dev_manual

dev_manual.idx: ${DEV_FILES}
	${LATEX} dev_manual
	#bibtex dev_manual
	${MAKEINDEX} dev_manual.idx

##########

HYPRE_ref_manual/index.html: ref_manual.dxx 
	doc++ -d HYPRE_ref_manual -B hypre_wiw.html ref_manual.dxx 2>&1
	cp -f hypre_wiw.gif HYPRE_ref_manual

HYPRE_ref_manual.ps: ref_manual.dvi
	${DVIPS} -o HYPRE_ref_manual.ps ref_manual.dvi 		

ref_manual.dvi: version.tex ref_manual.tex
	${LATEX} ref_manual
	${LATEX} ref_manual

ref_manual.tex: ref_manual.dxx
	doc++ -t -o ref_manual.tex ref_manual.dxx

##########

version.tex:
	@ \
	VNUM=`../utilities/version -number`; \
	VDATE=`../utilities/version -date`; \
	echo "\def\HYPREVersion{$$VNUM}" > version.tex; \
	echo "\def\HYPREVersionDate{$$VDATE}" >> version.tex

##################################################################
# Generic rules
##################################################################

