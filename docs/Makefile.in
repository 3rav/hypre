#BHEADER***********************************************************************
# (c) 1998   The Regents of the University of California
#
# See the file COPYRIGHT_and_DISCLAIMER for a complete copyright
# notice, contact person, and disclaimer.
#
# $Revision$
#EHEADER***********************************************************************

.SUFFIXES:
.SUFFIXES: .c .dxx .html .tex

srcdir = @srcdir@
VPATH = @srcdir@

ONLINE_OPTS =\
 -show_section_numbers\
 -bottom_navigation

##################################################################
# Targets
##################################################################

all: html ps

install: all

clean:
	@/bin/rm -f *.aux *.bbl *.blg *.dvi *.log *.dlog *.toc
	@/bin/rm -f *.idx *.ilg *.ind 

veryclean: clean
	@/bin/rm -fr usr_manual
	@/bin/rm -f  usr_manual.ps
	@/bin/rm -fr dev_manual
	@/bin/rm -f  dev_manual.ps
	@/bin/rm -f  code_ref.tex code code_ref.ps
	@/bin/rm -fr code_ref_html

##################################################################
# Rules
##################################################################

html: usr_html dev_html code_ref_html

ps: usr_ps dev_ps code_ref.ps

usr: usr_html usr_ps
usr_html: usr_manual/usr_manual.html
usr_ps: usr_manual.ps

dev: dev_html dev_ps
dev_html: dev_manual/dev_manual.html
dev_ps: dev_manual.ps

code_ref: code_ref_html code_ref.ps

##########

USR_FILES =\
 usr_building_code.tex\
 usr_manual.tex
 
usr_manual/usr_manual.html: usr_manual.dvi
	latex2html ${ONLINE_OPTS} usr_manual.tex

usr_manual.ps: usr_manual.dvi
	dvips -o usr_manual.ps usr_manual

usr_manual.dvi: version.tex usr_manual.idx
	latex usr_manual
	latex usr_manual

usr_manual.idx: ${USR_FILES} 
	latex usr_manual
	#bibtex usr_manual
	makeindex usr_manual.idx

##########

INTERFACE_DOCIFIED_FILES =\
 ../struct_linear_solvers/HYPRE_struct_pcg.c

IMPLEMENTATION_DOCIFIED_FILES =
# ../struct_matrix_vector/communication.c

INTERFACE_DXX =\
 ${INTERFACE_DOCIFIED_FILES:.c=.dxx}

IMPLEMENTATION_DXX =\
 ${IMPLEMENTATION_DOCIFIED_FILES:.c=.dxx}

${INTERFACE_DXX}: ${INTERFACE_DOCIFIED_FILES}

${IMPLEMENTATION_DXX}: ${IMPLEMENTATION_DOCIFIED_FILES}

interface_ref.dxx: ${INTERFACE_DXX} 

implementation_ref.dxx: ${IMPLEMENTATION_DXX}

code_ref.dxx: implementation_ref.dxx interface_ref.dxx

code_ref_html: code_ref.dxx
	doc++ -d code_ref_html code_ref.dxx

code_ref.tex: code_ref.dxx
	doc++ -t -o code_ref.tex code_ref.dxx

code_ref.dvi: code_ref.tex
	latex code_ref.tex
	latex code_ref.tex

code_ref.ps: code_ref.dvi
	dvips -o code_ref.ps code_ref.dvi 		

##########

DEV_FILES =\
 dev_QA.tex\
 dev_autotest.tex\
 dev_coding.tex\
 dev_design.tex\
 dev_documentation.tex\
 dev_error_handling.tex\
 dev_install.tex\
 dev_language_interop.tex\
 dev_makefile.tex\
 dev_manual.tex\
 dev_reference.tex\
 dev_requirements.tex

dev_manual/dev_manual.html: dev_manual.dvi
	latex2html ${ONLINE_OPTS} dev_manual.tex

dev_manual.ps: dev_manual.dvi
	dvips -o dev_manual.ps dev_manual

dev_manual.dvi: version.tex dev_manual.idx
	latex dev_manual
	latex dev_manual

dev_manual.idx: ${DEV_FILES}
	latex dev_manual
	#bibtex dev_manual
	makeindex dev_manual.idx

##########

version.tex:
	echo "\def\HYPREVersion{Revision: 0.00}" > version.tex

##################################################################
# Generic rules
##################################################################

.c.dxx:
	docify $< $@
