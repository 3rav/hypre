#BHEADER***********************************************************************
# (c) 1998   The Regents of the University of California
#
# See the file COPYRIGHT_and_DISCLAIMER for a complete copyright
# notice, contact person, and disclaimer.
#
# $Revision$
#EHEADER***********************************************************************

SHELL = /bin/sh

srcdir = @srcdir@
VPATH = @srcdir@

#These are the directories for structured interface
HYPRE_STRUCT_DIRS =\
 blas\
 utilities\
 struct_matrix_vector\
 struct_linear_solvers

#These are the directories for IJ interface
HYPRE_IJ_DIRS =\
 blas\
 utilities\
 seq_matrix_vector\
 parcsr_matrix_vector\
 distributed_matrix\
 matrix_matrix\
 IJ_matrix_vector\
 distributed_linear_solvers/pilut\
 distributed_linear_solvers/ParaSails\
 parcsr_linear_solvers

#These are the directories for FEI interface
HYPRE_FEI_DIRS =\
 FEI_matrix_vector/fei-hypre\
 FEI_matrix_vector/fei-base\
 FEI_matrix_vector/isis-mv ${HYPRE_IJ_DIRS}

HYPRE_FEI_LIBFILES =\
 libFEI_BASE.a         libHYPRE_ls.a           libHYPRE_DistributedMatrix.a \
 libHYPRE_mv.a         libHYPRE_parcsr_ls.a    libHYPRE_FEI.a \
 libHYPRE_parcsr_mv.a  libHYPRE_seq_mv.a       libHYPRE_IJ_mv.a \
 libHYPRE_utilities.a  libHYPRE_MatrixMatrix.a libHYPRE_ParaSails.a \
 libHYPRE_DistributedMatrixPilutSolver.a  

# These are directories that are officially in HYPRE
HYPRE_DIRS =\
 ${HYPRE_STRUCT_DIRS}\
 ${HYPRE_IJ_DIRS}

# These are directories that are not yet officially in HYPRE
HYPRE_EXTRA_DIRS =\
 seq_linear_solvers/pamg\
 structIJ_matrix_vector\
 CI_struct_matrix_vector\
 CI_struct_linear_solvers @HYPRE_PETSCLIBDIRS@

all: struct IJ
	@ \
	echo "Making test drivers ..."; \
	(cd test; make veryclean; make); \
	echo ""

beta: all
	@ \
	HYPRE_INSTALL_DIR=`pwd`/hypre; \
	export HYPRE_INSTALL_DIR; \
	for i in ${HYPRE_EXTRA_DIRS}; \
	do \
	  if [ -d $$i ]; \
	  then \
	    echo "Making $$i ..."; \
	    (cd $$i; make install); \
	    echo ""; \
	  fi; \
	done; \
	echo "Making beta test drivers ..."; \
	(cd test; make beta); \
	echo ""

struct: base
	@ \
	HYPRE_INSTALL_DIR=`pwd`/hypre; \
	export HYPRE_INSTALL_DIR; \
	for i in ${HYPRE_STRUCT_DIRS}; \
	do \
	  if [ -d $$i ]; \
	  then \
	    echo "Making $$i ..."; \
	    (cd $$i; make install); \
	    echo ""; \
	  fi; \
	done

IJ: base
	@ \
	HYPRE_INSTALL_DIR=`pwd`/hypre; \
	export HYPRE_INSTALL_DIR; \
	for i in ${HYPRE_IJ_DIRS}; \
	do \
	  if [ -d $$i ]; \
	  then \
	    echo "Making $$i ..."; \
	    (cd $$i; make install); \
	    echo ""; \
	  fi; \
	done

fei: base
	@ \
	HYPRE_INSTALL_DIR=`pwd`/hypre; \
	export HYPRE_INSTALL_DIR; \
	for i in ${HYPRE_FEI_DIRS}; \
	do \
	  if [ -d $$i ]; \
	  then \
	    echo "Making $$i ..."; \
	    (cd $$i; make install); \
	    echo ""; \
	  fi; \
	done; \
	mkdir -p hypre/tmp; \
	mv -f hypre/lib/*.a hypre/tmp; \
	for i in ${HYPRE_FEI_LIBFILES}; \
	do \
	   ar x hypre/tmp/$$i; \
	done; \
	ar ruv /hypre/lib/libHYPRE_FEI.a; \
	echo ""

base:
	@ \
	mkdir -p hypre/include; \
	mkdir -p hypre/lib; \
	HYPRE_INSTALL_DIR=`pwd`/hypre; \
	cp -f HYPRE_config.h $$HYPRE_INSTALL_DIR/include/.;\
	cp -f HYPRE.h $$HYPRE_INSTALL_DIR/include/.

install: all
	@ \
	if [ ! "$$HYPRE_INSTALL_DIR" ]; \
	then \
	  echo "Error: set the HYPRE_INSTALL_DIR environment variable"; \
	  exit 1; \
	fi; \
	if [ ! -d $$HYPRE_INSTALL_DIR ]; \
	then \
	  echo "Error: no directory HYPRE_INSTALL_DIR=$$HYPRE_INSTALL_DIR"; \
	  exit 1; \
	fi; \
	echo "Installing hypre ..."; \
	cp -fr hypre/* $$HYPRE_INSTALL_DIR/.; \
	rm -Rf hypre

clean:
	@ \
	for i in ${HYPRE_DIRS} ${HYPRE_EXTRA_DIRS} ${HYPRE_FEI_DIRS}; \
	do \
	  if [ -d $$i ]; \
	  then \
	    echo "Cleaning $$i ..."; \
	    (cd $$i; make clean); \
	  fi; \
	done; \
	echo "Cleaning test ..."; \
	(cd test; make clean)

veryclean:
	@ \
	rm -Rf hypre; \
	for i in ${HYPRE_DIRS} ${HYPRE_EXTRA_DIRS} ${HYPRE_FEI_DIRS}; \
	do \
	  if [ -d $$i ]; \
	  then \
	    echo "Very-cleaning $$i ..."; \
	    (cd $$i; make veryclean); \
	  fi; \
	done; \
	echo "Very-cleaning test ..."; \
	(cd test; make veryclean)

