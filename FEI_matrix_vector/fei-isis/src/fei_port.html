<html>
<head>
  <title>Porting to the FEI v1-Final</title>
</head>

<body>

<h2><u>Porting FE Clients to the V1.0 FEI Specification</u></h2>

<h3><u> Contents </u></h3>

	<ul>
	    <li> <p><a href="#background"> Background </a><br>
	    <li> <p><a href="#additions"> Additions </a><br>
	    <li> <p><a href="#deletions"> Deletions </a><br>
	    <li> <p><a href="#modifications"> Modifications </a><br>
	    <li> <p><a href="#author"> Author Contact Information </a><br>
	    <li> <p><a href="#documents"> Associated Documentation </a><br>
	</ul>

<hr>

<h3><u> <a name="background"></a> Background </u></h3>

    <p> This document provides "how-to" information for porting finite-element
        clients from older versions of the FEI specification to the current
        v1.0f (i.e., v1.0 final) specification.  There are two separate 
        pre-v1.0f versions of the finite-element specification:</p>

	<ul>
	    <li> <p> v0.08 of the FEI specification, released in January, 1998<br>
	    <li> <p> a preliminary v1.0a specification released in May, 1998, that
	             was used primarily by the ALE3D team at Lawrence Livermore
	             National Laboratories.<br>
    </ul>

    <p> The instructions found here for porting older FE clients to the v1.0f
        implementation are decomposed into three components: additions, 
        deletions, and modifications.  Some of these changes occurred within
        the v0.08-to-v1.0a transition, while others provide additional 
        functions for multiphysics simulations found only in v1.0f.  Functions
        that were primarily modified in v1.0a are highlighted using an 
        <font color="#0000FF"><i>italicized blue footer</i></font>.</p>

<hr>

<h3><u> <a name="additions"></a> Additions </u></h3>

<p> A considerable number of class methods were added between v0.08 and v1.0
    of the interface specification.  They fall into three general classes:</p>

    <ul>
         <li> methods used to simplify handling of multiphysics problems
	     <li> methods used to provide initial solution estimates
	     <li> utility methods
    </ul>

<p> All three of these classes are presented below.</p>

<p> The simulation of multiphysics problems is now simplified by including the
    notion of a "Field Identifier" that aids in the identification of each
    distinct solution field.  The new required <b>initFields</b> method permits
    a global identification of all solution fields found in the simulation.</p>


<pre><tt>    int initFields(int numFields,
                   const int *cardFields, 
                   const int *fieldIDs);
</tt></pre>

<br>
<p> The <b>getBlockFieldNodeSolution</b> method permits the return of solution
    parameters for a given block on a field-by-field basis.  With the exception
    of the field identifier <i>fieldID</i>, the call to this method is identical
    to that for the existing method <b>getBlockNodeSolution</b></p>

<pre><tt>    int getBlockFieldNodeSolution(GlobalID elemBlockID,
                                  int fieldID,
                                  GlobalID *nodeIDList, 
                                  int& lenNodeIDList, 
                                  int *offset,
                                  double *results);
</tt></pre>

<br>
<p> The <b>putBlockNodeSolution</b> method permits passing nodal solution 
    estimates to the solver on a block-by-block basis.</p>

<pre><tt>    int putBlockNodeSolution(GlobalID elemBlockID, 
                             const GlobalID *nodeIDList, 
                             int lenNodeIDList, 
                             const int *offset, 
                             const double *estimates);
                             
    <font color="#0000FF"><i>putBlockNodeSolution() is found in v1.0a</i></font>
</tt></pre>

<br>
<p> The <b>putBlockFieldNodeSolution</b> method permits passing nodal solution 
    estimates to the solver on a block-by-block basis in a manner similar to
    <b>putBlockNodeSolution</b>, but using only one solution field at a time.</p>

<pre><tt>    int putBlockFieldNodeSolution(GlobalID elemBlockID, 
                                  int fieldID, 
                                  const GlobalID *nodeIDList, 
                                  int lenNodeIDList, 
                                  const int *offset,
                                  const double *estimates);
</tt></pre>
         
<br>
<p> The <b>putBlockElemSolution</b> method permits passing elemental solution 
    estimates to the solver on a block-by-block basis.</p>

<pre><tt>    int putBlockElemSolution(GlobalID elemBlockID,  
                             const GlobalID *elemIDList, 
                             int lenElemIDList, 
                             const int *offset,  
                             const double *estimates, 
                             int numElemDOF);
                             
    <font color="#0000FF"><i>putBlockElemSolution() is found in v1.0a</i></font>
</tt></pre>
         
<br>
<p> The <b>putCRMultParam</b> method permits passing Lagrange multiplier 
    estimates to the solver module.</p>
  
<pre><tt>    int putCRMultParam(int CRMultID, 
                       int numMultCRs,
                       const double *multEstimates);

    <font color="#0000FF"><i>putCRMultParam() is found in v1.0a</i></font>
</tt></pre>
         
<br>
<p> The <b>getBlockNodeIDList</b> method returns the node identifier list
    required to utilize the <b>getBlockNodeSolution</b> and
    <b>getBlockFieldNodeSolution</b> solution return methods, as well as the
    <b>putBlockNodeSolution</b> and <b>putBlockFieldNodeSolution</b> 
    initial solution estimate functions.</p>
  
<pre><tt>    int getBlockNodeIDList(GlobalID elemBlockID,
                           GlobalID *nodeIDList, 
                           int& lenNodeIDList);

    <font color="#0000FF"><i>getBlockNodeIDList() is found in v1.0a</i></font>
</tt></pre>
         
<br>
<p> The <b>getBlockElemIDList</b> method returns the element identifier 
    list required to utilize the <b>getBlockElemSolution</b> and
    <b>putBlockElemSolution</b> methods.</p>
                                 
<pre><tt>    int getBlockElemIDList(GlobalID elemBlockID, 
                           GlobalID *elemIDList, 
                           int& lenElemIDList);

    <font color="#0000FF"><i>getBlockElemIDList() is found in v1.0a</i></font>
</tt></pre>

<br>
<p> The <b>getNumBlockActNodes</b> method returns the number of active 
    nodes in a given element block.</p>

<pre><tt>    int getNumBlockActNodes(GlobalID blockID);
</tt></pre>

<br>
<p> The <b>getNumBlockActEqns</b> method returns the number of active 
    equations in a given element block.</p>

<pre><tt>    int getNumBlockActEqns(GlobalID blockID);
</tt></pre>

<br>
<p> The <b>getNumEqnsPerElement</b> method returns the number of element 
    equations (nodal and elemental) for elements from a given element 
    block.</p>

<pre><tt>    int getNumEqnsPerElement(GlobalID blockID);
</tt></pre>

<br>
<p> The <b>getNumBlockElements</b> method returns the number of elements 
    associated with a given element block.</p>

<pre><tt>    int getNumBlockElements(GlobalID blockID);
</tt></pre>

<br>
<p> The <b>getNumBlockElemEqns</b> method returns the element equations
    required for a given block, for use in sizing arrays used with the
    <b>getBlockElemIDList</b> method.</p>

<pre><tt>    int getNumBlockElemEqns(GlobalID blockID);                                      
</tt></pre>

<hr>

<h3><u> <a name="deletions"></a> Deletions </u></h3>

<p> The <b>initEssBCNodeSet</b> method has been deleted, in the interest of
    simplicity.  The only point where boundary-condition information 
    (of any kind, including essential boundary conditions) now needs to be
    passed is in the load step, using the <b>loadBCSet</b> method.</p>

<pre><tt>    int initEssBCNodeSet(const GlobalID *essBCNodeSet,  
                         const int *essBCSolnParamSet,
                         const int lenEssBCNodeSet);
</tt></pre>

<br>
<p> The <b>initExtSendNodeSet</b> and <b>initExtRecvNodeSet</b> pair of methods 
    have been replaced by the single unified method <b>initExtNodeSet</b>, 
    which takes the same arguments.  
    In practice, existing logic for handling external nodes
    within the finite-element client can be left intact, and the unified 
    method called for each existing case.</p>

<pre><tt>    int initExtSendNodeSet(const GlobalID *extNodeIDs,  
                           int lenExtNodeIDs, 
                           const int *const *extProcIDs, 
                           const int *lenExtProcIDs);
</tt></pre>

<pre><tt>    int initExtRecvNodeSet(const GlobalID *extNodeIDs,  
                           int lenExtNodeIDs, 
                           const int *const *extProcIDs, 
                           const int *lenExtProcIDs);
                           
    <font color="#0000FF"><i>this replacement is found in v1.0a</i></font>
</tt></pre>

<br>
<p> The <b>getCRPenSolution</b> and <b>getCRPenParam</b> methods have 
    been removed, as penalty parameters are now always set by the 
    finite-element client, hence no return methods are needed</p>

<pre><tt>    int getCRPenSolution(int& numCRPenSets, 
                         int *CRPenIDs,  
                         int *offset,
                         double *answers);
</tt></pre>
<pre><tt>    int getCRPenParam(const int CRPenID, 
                      const int numPenCRs,
                      double *penValues);
</tt></pre>

<br>
<p> The <b>getNumWorkSets</b> and <b>getNumElemsPerWorkSet</b> utility 
    methods have been removed, as the new specification relaxes the 
    requirement that these values be uniquely defined over the 
    initialization and load steps. </p>

<pre><tt>    int getNumWorkSets(const GlobalID blockID);
</tt></pre>

<pre><tt>    int getNumElemsPerWorkSet(const GlobalID blockID, 
                              const int workSetID);
</tt></pre>

<hr>


<h3><u> <a name="modifications"></a> Modifications </u></h3>

<p> Some of the class methods defined in the FEI specification have been modified
    to add new functions or simplify the use of the interface implementation.  In
    the following exposition of these modified procedures, changes from previous
    versions are highlighted in <font color="#FF0000">red</font>.</p>



<br>
<p> The <b>FEI</b> constructor method now takes two arguments, 
    one for MPI communications, and the other for identifying the master 
    processor.</p>

<pre><tt>    FEI(MPI_Comm <font color="#FF0000">FEI_COMM_WORLD</font>, 
                          int <font color="#FF0000">masterRank = 0</font>); 
</tt></pre>
    

<br>
<p> The <b>initSolveStep</b> solution-step initialization method no longer 
    requires information about the number of node sets present in the simulation.  
    The second parameter now indicates the type of solution services to be 
    invoked (currently, only linear systems of algebraic equations with a single 
    right-hand-side are supported).</p>

<pre><tt>    int initSolveStep(int numElemBlocks, 
                      int <font color="#FF0000">solvType</font>);    

    <font color="#0000FF"><i>this modification is found in v1.0a</i></font>
</tt></pre>

<br>
<p> The <b>beginInitElemBlock</b> method has been generalized to include more 
    arguments, both for handling multiphysics simulations and to permit
    using different-sized worksets in the initialization and load phases.</p>

<pre><tt>    int beginInitElemBlock(GlobalID elemBlockID,  
                           int numNodesPerElement, 
                           const int <font color="#FF0000">*numElemFields</font>,
                           const int *const <font color="#FF0000">*elemFieldIDs</font>,
                           int <font color="#FF0000">interleaveStrategy</font>,
                           int numElemDOF, 
                           int numElemSets,
                           int <font color="#FF0000">numElemTotal</font>);                                    

</tt></pre>

<br>
<p> The <b>beginInitNodeSets</b> method now has two fewer passed parameters, 
    to reflect the facts that: <br>&nbsp;
    (a) no boundary-condition information needs to be
    passed during the initialization phase, and <br>&nbsp;
    (b) there is no longer any need
    to distinguish between external send and receive nodes</p>

<pre><tt>    int beginInitNodeSets(int numSharedNodeSets, 
                          int numExtNodeSets);

</tt></pre>

<br>
<p> The <b>initExtSendNodeSet</b> and <b>initExtRecvNodeSet</b> pair of methods 
    have been replaced by the single unified method <b>initExtNodeSet</b>, 
    which takes the same arguments.</p>

<pre><tt>    int <font color="#FF0000">initExtNodeSet</font>(const GlobalID *extNodeIDs,  
                       int lenExtNodeIDs, 
                       const int *const *extProcIDs, 
                       const int *lenExtProcIDs);

    <font color="#0000FF"><i>this replacement is found in v1.0a</i></font>
</tt></pre>

<br>
<p> The <b>initCRMult</b> method has two changes: <br>&nbsp;
    (a) addition of a field list to identify the fields present in the constraint, 
    and <br>&nbsp;
    (b) reordering of the remaining arguments to enforce an "input-first, 
    output-last" approach<br><br>
    The latter modification results in moving the returned constraint 
    multiplier ID to the end of the argument list.</p>
    
<pre><tt>    int initCRMult(const GlobalID *const *CRNodeTable,
                   const int <font color="#FF0000">*CRFieldList</font>,
                   int numMultCRs, 
                   int lenCRNodeList,
                   int& <font color="#FF0000">CRMultID</font>); 
</tt></pre>

<br>
<p> Similar modifications are found in the <b>initCRPen</b> method:</p>

<pre><tt>    int initCRPen(const GlobalID *const *CRNodeTable, 
                  const int <font color="#FF0000">*CRFieldList</font>,
                  int numPenCRs, 
                  int lenCRNodeList,
                  int& <font color="#FF0000">CRPenID</font>); 
</tt></pre>

<br>
<p> The <b>loadBCSet</b> method now includes a field identifier to specify
    which solution field the boundary-condition data pertains to.</p>

<pre><tt>    int loadBCSet(const GlobalID *BCNodeSet,  
                  int lenBCNodeSet,  
                  int <font color="#FF0000">BCFieldID</font>,
                  const double *const *alphaBCDataTable,  
                  const double *const *betaBCDataTable,  
                  const double *const *gammaBCDataTable);
</tt></pre>

<br>
<p> The <b>beginLoadElemBlock</b> method now includes additional information,
    both to permit varying the workset size between the initialization and
    load steps, and also to provide argument-calling consistency between 
    these two steps.</p>

<pre><tt>    int beginLoadElemBlock(GlobalID elemBlockID,
                           int <font color="#FF0000">numElemSets</font>,
                           int <font color="#FF0000">numElemTotal</font>);
</tt></pre>

<br>
<p> The <b>loadElemSet</b> method is a renaming of the earlier 
    <b>loadElementData</b> method, and it also includes additional information,
    both to permit varying the workset size between the initialization and
    load steps, and also to provide argument-calling consistency between 
    the initialization and load steps.</p>

<pre><tt>    int <font color="#FF0000">loadElemSet</font>(int elemSetID, 
                    int <font color="#FF0000">numElems</font>, 
                    const GlobalID <font color="#FF0000">*elemIDs</font>,  
                    const GlobalID *const *elemConn,
                    const double *const *const *elemStiffness,
                    const double *const *elemLoad,
                    int elemFormat);
</tt></pre>


<br>
<p> The <b>loadCRMult</b> method has two additional parameters: (a) a list of
    field identifiers to permit multi-point/multi-field constraints, and (b) a
    length parameter <i>lenCRNodeList</i> that provides consistency in
    argument-passing between the initialization and load steps.</p>

<pre><tt>    int loadCRMult(int CRMultID, 
                   int numMultCRs,
                   const GlobalID *const *CRNodeTable, 
                   const int <font color="#FF0000">*CRFieldList</font>,
                   const double *const *CRWeightTable,
                   const double *CRValueList,
                   int <font color="#FF0000">lenCRNodeList</font>);
</tt></pre>

<br>
<p> The <b>loadCRPen</b> method also has the same two additional parameters
    as <b>loadCRMult</b>, but in addition, the <i>CRPenType</i> parameter has been 
    removed from the argument list of <b>loadCRPen</b>, as this parameter was
    unused.</p>

<pre><tt>    int loadCRPen(int CRPenID, 
                  int numPenCRs, 
                  const GlobalID *const *CRNodeTable,
                  const int <font color="#FF0000">*CRFieldList</font>,
                  const double *const *CRWeightTable,
                  const double *CRValueList,
                  const double *penValues,
                  int <font color="#FF0000">lenCRNodeList</font>);

</tt></pre>

<br>
<p> The <b>getBlockElemSolution</b> method is a renaming of the existing
    <b>getElemBlockSolution</b> method so as to provide naming consistency
    in the blocked-solution return procedures.</p>

<pre><tt>    int <font color="#FF0000">getBlockElemSolution</font>(GlobalID elemBlockID,  
                             GlobalID *elemIDList,
                             int& lenElemIDList, 
                             int *offset,  
                             double *results, 
                             int& numElemDOF) = 0;
</tt></pre>

<hr>


<h3><u> <a name="author"></a> Author Contact Information </u></h3>

    <p> Questions and comments with regard to this HTML document or those 
        obtained from this web page should be directed to 
        <a href="mailto:kdmish@csuchico.edu"> K.D. Mish</a>.  
        General questions about the nature or design
        of the FE Interface can be directed to the FEI mailing list by sending
        e-mail to <a href="mailto:if-fei@isis.ca.sandia.gov">if-fei</a></p>

    <ul>
         <li> Kim Mish, Dept of Mechanical Engineering, CSU Chico
	     <li> Phone: (530) 521-6099
	     <li> Email: <a href="mailto:kdmish@csuchico.edu">kdmish@csuchico.edu</a>
    </ul>

<hr>

<h3><u> <a name="documents"></a> Associated Documentation </u></h3>

    <p> Supporting documentation available here includes Adobe Acrobat versions 
        of the the FEI v1.0 Annotated Reference Document, and a Syntax-highlighted
        version of the fei.h header file</p>

    <ul>
	    <li><a href="fei_annt.pdf">
	        Download </a> Annotated Reference Manual fei_annt.pdf (305 kB)<br>
	    <li><a href="fei_list.pdf">
	        Download </a> FEI header listing fei_list.pdf (32 kB)<br>
    </ul>


<hr>

<p><b><i>html by k.d. mish, Dec 15, 1998</i></b><p>

</body>
</html>
