#BHEADER***********************************************************************
# (c) 1998   The Regents of the University of California
#
# See the file COPYRIGHT_and_DISCLAIMER for a complete copyright
# notice, contact person, and disclaimer.
#
# $Revision$
#EHEADER***********************************************************************

include ../config/Makefile.config

HYPRE_DIR = @HYPRE_TOP_SRC_DIR@

CC=@CC@
CXX=@CXX@
F77=@F77@

C_COMPILE_FLAGS=@CFLAGS@
CXX_COMPILE_FLAGS=@CXXFLAGS@
F77_COMPILE_FLAGS=@F77FLAGS@
LD_LINK_FLAGS=@LDFLAGS@
CINCLUDES=@INCLUDES@ @MPIINCLUDE@
CDEFS = -DHYPRE_TIMING
 
CFLAGS = \
 ${C_COMPILE_FLAGS}\
 -I$(srcdir)\
 -I$(srcdir)/..\
 -I../hypre/include\
 ${CINCLUDES}\
 ${CDEFS}
 
FFLAGS = \
 ${F77_COMPILE_FLAGS}
 
MPILIBFLAGS = @MPILIBDIRS@ @MPILIBS@ @MPIFLAGS@ 
LIBFLAGS = @LIBDIRS@ @LIBS@
LDLIBFLAGS = @LDLIBDIRS@ @LDLIBS@
LAPACKLIBFLAGS =  @LAPACKLIBDIRS@ @LAPACKLIBS@
BLASLIBFLAGS =  @BLASLIBDIRS@ @BLASLIBS@

LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_sstruct_ls\
 -lHYPRE_sstruct_mv\
 -lHYPRE_struct_ls\
 -lHYPRE_struct_mv\
 -lHYPRE_parcsr_ls\
 -lHYPRE_DistributedMatrixPilutSolver \
 -lHYPRE_ParaSails \
 -lHYPRE_Euclid \
 -lHYPRE_MatrixMatrix \
 -lHYPRE_DistributedMatrix \
 -lHYPRE_IJ_mv\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_krylov\
 -lHYPRE_utilities\
 ${LAPACKLIBFLAGS} \
 ${BLASLIBFLAGS} \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

###########################################
# Commpkg definitions
###########################################

COMMPKG_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_parcsr_ls\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_utilities\
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

###########################################
# Struct definitions
###########################################

STRUCT_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_struct_ls\
 -lHYPRE_struct_mv\
 -lHYPRE_krylov\
 -lHYPRE_utilities\
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

###########################################
# Struct_es definitions
###########################################

STRUCT_ES_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_struct_ls\
 -lHYPRE_struct_mv\
 -lHYPRE_parcsr_ls\
 -lHYPRE_DistributedMatrixPilutSolver \
 -lHYPRE_ParaSails \
 -lHYPRE_Euclid \
 -lHYPRE_MatrixMatrix \
 -lHYPRE_DistributedMatrix \
 -lHYPRE_IJ_mv\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_krylov\
 -lHYPRE_utilities\
 -lHYPRE_lobpcg \
 ${LAPACKLIBFLAGS} \
 ${BLASLIBFLAGS} \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

###########################################
# Sstruct definitions
###########################################

SSTRUCT_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_sstruct_ls\
 -lHYPRE_sstruct_mv\
 -lHYPRE_struct_ls\
 -lHYPRE_struct_mv\
 -lHYPRE_parcsr_ls\
 -lHYPRE_DistributedMatrixPilutSolver \
 -lHYPRE_ParaSails \
 -lHYPRE_Euclid \
 -lHYPRE_MatrixMatrix \
 -lHYPRE_DistributedMatrix \
 -lHYPRE_IJ_mv\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_krylov\
 -lHYPRE_utilities\
 ${LAPACKLIBFLAGS} \
 ${BLASLIBFLAGS} \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

###########################################
# Sstruct_es definitions
###########################################

SSTRUCT_ES_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_sstruct_ls\
 -lHYPRE_sstruct_mv\
 -lHYPRE_struct_ls\
 -lHYPRE_struct_mv\
 -lHYPRE_parcsr_ls\
 -lHYPRE_DistributedMatrixPilutSolver \
 -lHYPRE_ParaSails \
 -lHYPRE_Euclid \
 -lHYPRE_MatrixMatrix \
 -lHYPRE_DistributedMatrix \
 -lHYPRE_IJ_mv\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_krylov\
 -lHYPRE_utilities\
 -lHYPRE_lobpcg\
 ${LAPACKLIBFLAGS} \
 ${BLASLIBFLAGS} \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

###########################################
# IJ definitions
###########################################

IJ_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_parcsr_ls\
 -lHYPRE_DistributedMatrixPilutSolver \
 -lHYPRE_ParaSails \
 -lHYPRE_Euclid \
 -lHYPRE_MatrixMatrix \
 -lHYPRE_DistributedMatrix \
 -lHYPRE_IJ_mv\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_krylov\
 -lHYPRE_utilities\
 ${LAPACKLIBFLAGS} \
 ${BLASLIBFLAGS} \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}


###########################################
# IJ_ES definitions
###########################################

IJ_ES_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_parcsr_ls\
 -lHYPRE_DistributedMatrixPilutSolver \
 -lHYPRE_ParaSails \
 -lHYPRE_Euclid \
 -lHYPRE_MatrixMatrix \
 -lHYPRE_DistributedMatrix \
 -lHYPRE_IJ_mv\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_krylov\
 -lHYPRE_utilities\
 -lHYPRE_lobpcg\
 ${LAPACKLIBFLAGS} \
 ${BLASLIBFLAGS} \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}


###########################################
# IJ_MV definitions
###########################################

IJ_MV_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_parcsr_ls\
 -lHYPRE_IJ_mv\
 -lHYPRE_parcsr_mv\
 -lHYPRE_seq_mv\
 -lHYPRE_utilities\
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

###########################################
# FEI definitions
###########################################

FEICXX_LFLAGS =\
 ${LD_LINK_FLAGS}\
 -L../hypre/lib\
 -lHYPRE_LSI\
 -lHYPRE_superlu\
 ${LAPACKLIBFLAGS} \
 ${BLASLIBFLAGS} \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}

##################################################################
# Targets
##################################################################

HYPRE_STANDARD_DRIVERS =\
 ij.c\
 ij_es.c\
 ij_mv.c\
 new_ij.c\
 sstruct.c\
 sstruct_es.c\
 struct.c\
 struct_es.c

HYPRE_BABEL_DRIVERS =\
 struct_b.c\
 ij_b.c

HYPRE_DRIVERS_CXX =\
 ${HYPRE_DRIVERS:.c=.CXX.C}

HYPRE_FEI_DRIVERS_CXX =\
 fei.C

HYPRE_STANDARD_DRIVERS_F77 =\
 f77_ij.f\
 f77_ij_mv.f\
 f77_struct.f

HYPRE_BABEL_DRIVERS_CXX =

HYPRE_BABEL_DRIVERS_F77 =\
 f77_ij_b.f\
 f77_struct_b.f

#ifndef is gmake only, can't be used...
#ifndef BABELLIBFLAGS
 HYPRE_DRIVERS = ${HYPRE_STANDARD_DRIVERS}
 HYPRE_DRIVERS_F77 = ${HYPRE_STANDARD_DRIVERS_F77}
#else
# HYPRE_DRIVERS = ${HYPRE_STANDARD_DRIVERS} ${HYPRE_BABEL_DRIVERS}
# HYPRE_DRIVERS_F77 = ${HYPRE_STANDARD_DRIVERS_F77} ${HYPRE_BABEL_DRIVERS_F77}
#endif

HYPRE_DRIVER_OBJS=${HYPRE_DRIVERS:.c=.o}
HYPRE_DRIVER_CXX_OBJS=${HYPRE_DRIVERS_CXX:.C=.o}
HYPRE_DRIVER_F77_OBJS=${HYPRE_DRIVERS_F77:.f=.o}
HYPRE_FEI_DRIVER_CXX_OBJS=${HYPRE_FEI_DRIVERS_CXX:.C=.o}

HYPRE_DRIVER_EXECS=${HYPRE_DRIVERS:.c=}
HYPRE_DRIVER_CXX_EXECS=${HYPRE_DRIVERS_CXX:.C=}
HYPRE_DRIVER_F77_EXECS=${HYPRE_DRIVERS_F77:.f=}
HYPRE_FEI_DRIVER_CXX_EXECS=${HYPRE_FEI_DRIVERS_CXX:.C=}

HYPRE_BABEL_DRIVER_OBJS=${HYPRE_BABEL_DRIVERS:.c=.o}
HYPRE_BABEL_DRIVER_CXX_OBJS=${HYPRE_BABEL_DRIVERS_CXX:.C=.o}
HYPRE_BABEL_DRIVER_F77_OBJS=${HYPRE_BABEL_DRIVERS_F77:.f=.o}

HYPRE_BABEL_DRIVER_EXECS=${HYPRE_BABEL_DRIVERS:.c=}
HYPRE_BABEL_DRIVER_CXX_EXECS=${HYPRE_BABEL_DRIVERS_CXX:.C=}
HYPRE_BABEL_DRIVER_F77_EXECS=${HYPRE_BABEL_DRIVERS_F77:.f=}

all: ${HYPRE_DRIVER_EXECS}

all++: ${HYPRE_DRIVER_CXX_EXECS}

all77: ${HYPRE_DRIVER_F77_EXECS}

fei++: ${HYPRE_FEI_DRIVER_CXX_EXECS}

babel: ${HYPRE_BABEL_DRIVER_EXECS} ${HYPRE_BABEL_DRIVER_F77_EXECS}

install:

clean:
	@rm -f *.o

veryclean: clean
	@rm -f ${HYPRE_DRIVER_EXECS}
	@rm -f ${HYPRE_DRIVER_CXX_EXECS}
	@rm -f ${HYPRE_DRIVER_F77_EXECS}
	@rm -f ${HYPRE_BABEL_DRIVER_EXECS}
	@rm -f ${HYPRE_BABEL_DRIVER_CXX_EXECS}
	@rm -f ${HYPRE_BABEL_DRIVER_F77_EXECS}
	@rm -f ${HYPRE_FEI_DRIVER_CXX_EXECS}

##################################################################
# Rules
##################################################################

PURIFY = purify
PURIFY_TO_FILE = purify \
 -log-file=struct_linear_solvers.purify \
 -append-logfile=yes

struct: struct.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${STRUCT_LFLAGS}

struct_es: struct_es.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${STRUCT_ES_LFLAGS}

sstruct: sstruct.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${SSTRUCT_LFLAGS}

sstruct_es: sstruct_es.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${SSTRUCT_ES_LFLAGS}

ij: ij.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${IJ_LFLAGS}

ij_es: ij_es.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${IJ_ES_LFLAGS}

ij_mv: ij_mv.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${IJ_MV_LFLAGS}

new_ij: new_ij.o
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${IJ_LFLAGS}

f77_struct: f77_struct.o
	@echo  "Building" $@ "... "
	${F77} -o $@ $@.o ${FFLAGS} ${STRUCT_LFLAGS}

f77_ij: f77_ij.o
	@echo  "Building" $@ "... "
	${F77} -o $@ $@.o ${FFLAGS} ${IJ_LS_LFLAGS}

f77_ij_mv: f77_ij_mv.o
	@echo  "Building" $@ "... "
	${F77} -o $@ $@.o ${FFLAGS} ${IJ_MV_LFLAGS}

# special autotest target
${HYPRE_FEI_DRIVER_CXX_EXECS}: ${HYPRE_FEI_DRIVER_CXX_OBJS}
	@echo  "Building" $@ "... "
	${CXX} -o $@ $@.o -DNOFEI ${FEICXX_LFLAGS}

##################################################################
# Babel version of above
##################################################################
${HYPRE_BABEL_DRIVER_EXECS}: ${HYPRE_BABEL_DRIVER_OBJS}
	@echo  "Building" $@ "... "
	${CC} -o $@ $@.o ${BABELLIBFLAGS} ${LFLAGS}

${HYPRE_BABEL_DRIVER_F77_EXECS}: ${HYPRE_BABEL_DRIVER_F77_OBJS}
	@echo  "Building" $@ "... "
	${F77} -o $@ $@.o ${FFLAGS} ${LFLAGS}
