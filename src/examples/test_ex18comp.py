from scipy import *
from scipy import io
from scipy import sparse
from pyamg import gallery
from pyamg.krylov import gmres

# You do have to make sure that the same 4x4x4x4 grid, matrix stencil and x0
# and b are set up in ex18comp.py

grid = [4,4,4,4]
s = zeros([3,3,3,3], dtype=complex)
s[1, 1, 1, 1] =  9.90000000000000e+00 + 1.0j*0.00000000000000e+00
s[0, 1, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[2, 1, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 0, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 2, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 0, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 2, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 1, 0] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 1, 2] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
A00 = gallery.stencil_grid(s,grid,format='csr')

s = zeros([3,3,3,3], dtype=complex)
s[1, 1, 1, 1] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[0, 1, 1, 1] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[2, 1, 1, 1] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[1, 0, 1, 1] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[1, 2, 1, 1] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[1, 1, 0, 1] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[1, 1, 2, 1] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[1, 1, 1, 0] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
s[1, 1, 1, 2] = 1.00000000000000e-01+ 1.0j*1.32124312000000e-01
A01 = gallery.stencil_grid(s,grid,format='csr')

s = zeros([3,3,3,3], dtype=complex)
s[1, 1, 1, 1] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[0, 1, 1, 1] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[2, 1, 1, 1] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[1, 0, 1, 1] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[1, 2, 1, 1] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[1, 1, 0, 1] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[1, 1, 2, 1] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[1, 1, 1, 0] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
s[1, 1, 1, 2] = -1.00000000000000e-01- 1.0j*1.00000000000000e-01
A10 = gallery.stencil_grid(s,grid,format='csr')

s = zeros([3,3,3,3], dtype=complex)
s[1, 1, 1, 1] =  9.90000000000000e+00 + 1.0j*0.00000000000000e+00
s[0, 1, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[2, 1, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 0, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 2, 1, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 0, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 2, 1] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 1, 0] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
s[1, 1, 1, 2] = -1.00000000000000e+00 + 1.0j*0.00000000000000e+00
A11 = gallery.stencil_grid(s,grid,format='csr')

A = sparse.bmat([[A00, A01],[A10,A11]], format='csr')
b = ones((A.shape[0],1))
x0 = zeros((A.shape[0],1))

res = []
x = gmres(A,b,x0=x0,tol=1e-10,residuals=res,orthog='mgs',restrt=5,maxiter=100)
print "\nPYAMG GMRES Residuals:\n"
for k,r in enumerate(res):
   print "   ||r_%2d|| = %1.6e"%(k,r)

print " "

