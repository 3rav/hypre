#BHEADER***********************************************************************
# (c) 1999   The Regents of the University of California
#
# See the file COPYRIGHT_and_DISCLAIMER for a complete copyright
# notice, contact person, and disclaimer.
#
# $Revision$
#EHEADER***********************************************************************

ARCH = alpha

.SUFFIXES: .cc .c .f .o

srcdir = @srcdir@

all: lib

CXX = @CXX@

SUPERLU_INCLUDE = -I/g/g2/chtong/SUPERLU/WEST/SuperLU/SRC
SUPERLU_LIB     = -L/g/g2/chtong/SUPERLU/WEST/SuperLU
MLPACK_LIB      = -L/g/g2/chtong/ML/WEST/ml/src

CXX_COMPILE_FLAGS=@CXXFLAGS@
CINCLUDES=@INCLUDES@ @MPIINCLUDE@
CXXDEFS = -DHYPRE_NO_PTHREAD_MANGLING -DSUPERLU -DMLPACK

CXXFLAGS = -w ${CXX_COMPILE_FLAGS} \
 ${CXXDEFS}\
 -I../..\
 -I../isis-mv\
 -I../../IJ_matrix_vector\
 -I../../utilities\
 -I../../parcsr_matrix_vector\
 -I../../parcsr_linear_solvers\
 -I../../seq_matrix_vector\
 -I../fei-base\
 ${SUPERLU_INCLUDE}\
 ${CXXINCLUDES}\

MPILIBFLAGS = @MPILIBDIRS@ @MPILIBS@ @MPIFLAGS@
LIBFLAGS = @LIBDIRS@ @LIBS@
LDLIBFLAGS = @LDLIBDIRS@ @LDLIBS@

RANLIB = @RANLIB@

LFLAGS =\
 -L.\
 -L../isis-mv\
 -L../../IJ_matrix_vector\
 -L../../utilities\
 -L../../parcsr_matrix_vector\
 -L../../parcsr_linear_solvers\
 -L../../seq_matrix_vector\
 -L../../distributed_matrix\
 -L../../distributed_linear_solvers/pilut\
 -L../../distributed_linear_solvers/ParaSails\
 -L../../matrix_matrix\
 -L../fei-base/lib/$(ARCH)\
 ${SUPERLU_LIB} ${MLPACK_LIB}\
 -lfei_isis\
 -lHYPRE_parcsr_ls \
 -lHYPRE_ParaSails \
 -lHYPRE_FEI_isismv \
 -lHYPRE_IJ_mv \
 -lml \
 -lHYPRE_utilities \
 -lHYPRE_parcsr_mv \
 -lHYPRE_MatrixMatrix \
 -lHYPRE_DistributedMatrix \
 -lHYPRE_DistributedMatrixPilutSolver \
 -lsuperlu_alpha \
 -lHYPRE_seq_mv \
 ${MPILIBFLAGS} ${LIBFLAGS} ${LDLIBFLAGS}\
 -ldxml -lm

FILES = HYPRE_LinSysCore.cc cfei.cc hypre_fei_reduce.cc hypre_fei_schur.cc \
        hypre_fei_misc.cc hypre_fei_ddamg.cc

OBJS = ${FILES:.cc=.o}

##################################################################
# Main rules
##################################################################

all: libHYPRE_FEI.a

lib: all

install: all
	@cp -f HYPRE_LinSysCore.h cfei.h fei-hypre.h $$HYPRE_INSTALL_DIR/include
	@cp -f libHYPRE_FEI.a $$HYPRE_INSTALL_DIR/lib

driver: driver.o libHYPRE_FEI.a
	@echo  "Linking" $@ "... "
	${CXX} -o $@ driver.o ${LFLAGS}

libHYPRE_FEI.a: ${OBJS}
	@echo  "Building $@ ... "
	@ar -rcu libHYPRE_FEI.a ${OBJS}
	${RANLIB} $@

##################################################################
# Targets
##################################################################

clean:
	@touch erase.tmp
	@rm -rf erase.tmp *.o ti_files driver

veryclean: clean
	@touch erase.tmp
	@rm -rf erase.tmp *.o *.a ti_files driver


##################################################################
# Generic rules
##################################################################

.cc.o:
	${CXX} -o $@ -c ${CXXFLAGS} $<

